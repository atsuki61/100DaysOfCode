
# Day 16: 音楽検索アプリ

今日のチャレンジでは、iTunes APIを利用して音楽を検索し、結果を表示するアプリケーションを作成しました。ユーザーが入力したキーワードに応じて動的にAPIにリクエストを送り、返ってきたデータを画面に表示する、実践的なアプリケーションです。

## 学習ポイント

### 1. 動的クエリによるAPI取得

これまでのAPI連携では、固定のURLにリクエストを送ることがほとんどでした。しかし、今回はユーザーの入力（検索キーワード）をURLに含めてリクエストを送信する必要があります。これを「動的クエリ」と呼びます。

**たとえ話：図書館の司書さんへの質問**

- **静的クエリ（今までの方法）**: 「おすすめの本をください」と毎回同じ質問をするようなもの。司書さんはいつも同じ本をくれます。
- **動的クエリ（今回の方法）**: 「『夏目漱石』に関する本を探してください」とか「『宇宙』がテーマの本はありますか？」と、探したいもの（キーワード）を具体的に伝えて質問するようなものです。司書さんは、あなたのリクエストに応じて、毎回違う本を探してくれます。

コードでは、JavaScriptのテンプレートリテラルを使って、ユーザーが入力した`searchTerm`をAPIのURLに埋め込んでいます。

```typescript
const response = await fetch(`https://itunes.apple.com/search?term=${searchTerm}&entity=song`);
```

これにより、ユーザーが検索バーに"Official髭男dism"と入力すれば、そのキーワードでiTunesのデータベースを検索しにいくことができます。

### 2. JSON結果のリスト表示

APIから返ってくるデータは、多くの場合JSON（ジェイソン）という形式のテキストです。これは、JavaScriptのオブジェクトや配列と非常によく似た構造をしています。

受け取ったJSONデータ（今回は曲のリスト）を画面に表示するには、`map`関数が非常に便利です。`map`関数は、配列の各要素を順番に取り出して、それぞれに同じ処理を行い、新しい配列を作成する機能です。

**たとえ話：招待状の作成**

ゲストのリスト（配列）があるとします。`map`関数は、そのリストを見ながら、一人ひとりの名前入りの招待状（Reactコンポーネント）を自動で作成してくれるようなものです。

```tsx
{results.map((song: Song) => (
  <li key={song.trackId} className="... ">
    <img src={song.artworkUrl100} alt={song.trackName} />
    <div>
      <h3>{song.trackName}</h3>
      <p>{song.artistName}</p>
      <audio controls src={song.previewUrl} />
    </div>
  </li>
))}
```

このコードでは、`results`という曲情報の配列から、1曲ずつ`song`として取り出し、その曲のジャケット写真、曲名、アーティスト名、プレビュー音源を持つリストアイテム（`<li>`）を生成しています。

### 3. ページネーションの概念

今回は実装していませんが、検索結果が非常に多い場合（例えば数千件）、一度にすべての結果を表示すると、ページの読み込みが遅くなったり、ユーザーが情報を見つけにくくなったりします。そこで「ページネーション」という考え方が重要になります。

**たとえ話：分厚い本の目次**

ページネーションは、分厚い本を「1ページ目」「2ページ目」と区切って読みやすくするようなものです。一度に全部のページを見せるのではなく、少しずつ見せることで、読者は混乱せずにすみます。

Webアプリケーションでは、以下のような方法で実装します。

- **ページ番号**: 「1, 2, 3, ...」といったページ番号を表示し、ユーザーがクリックするとそのページのデータをAPIから取得して表示する。
- **「もっと見る」ボタン**: ボタンをクリックするたびに、次のページのデータを読み込んで既存のリストの下に追加していく。
- **無限スクロール**: ユーザーがページを一番下までスクロールすると、自動的に次のページのデータを読み込む。

今回は基本的な実装にとどめましたが、より高度なアプリケーションを作る上では必須の知識となります。

## まとめ

Day 16では、ユーザーの入力に応じて動的にコンテンツを生成する、よりインタラクティブなアプリケーションの作り方を学びました。APIとの連携は、Web開発の面白さであり、重要なスキルの一つです。今日の学びを活かして、さらに色々なAPIを試してみましょう！
