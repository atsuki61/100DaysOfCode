# Day 19: クイズアプリ (カテゴリ選択機能追加)

## 📝 今日の目標
アニメに関するクイズアプリを改修し、カテゴリ選択機能を追加する。また、状態管理ロジックとデータ構造をより複雑な要件に対応できるように変更し、コンポーネントの責務を再設計する。

## 🎯 作成したもの
カテゴリ選択式の高難易度アニメクイズ（僕のヒーローアカデミア、鬼滅の刃、ハンター×ハンターの各10問）

### 主な機能
- **カテゴリ選択画面**: 挑戦したいアニメのクイズを選択できる。
- **質問画面**: 選択肢付きの質問表示、進捗バー。
- **結果画面**: スコア表示、正解・不正解リスト、解説付き。
- **リスタート機能**: カテゴリ選択画面から再挑戦可能。
- **ランダム出題**: カテゴリごとに毎回質問順序をシャッフル。

## 🔧 使用した技術
- **React**: `useState`による状態管理、コンポーネント分割、Propsによるデータフロー
- **TypeScript**: `Record<string, QuizQuestion[]>` を用いたデータ構造の型定義
- **Tailwind CSS**: レスポンシブデザイン、Gridレイアウト、動的スタイル
- **Next.js**: App Router、ファイル構成

## 📚 学習ポイント

### 1. データ構造の変更と状態管理の進化
当初は単一のクイズ配列 (`QuizQuestion[]`) を扱っていましたが、カテゴリ選択機能の追加に伴い、データ構造を `Record<string, QuizQuestion[]>` に変更しました。

```typescript
// 変更前
export const animeQuizData: QuizQuestion[] = [ ... ];

// 変更後
export const quizDataByCategory: Record<string, QuizQuestion[]> = {
  "僕のヒーローアカデミア": [ ... ],
  "鬼滅の刃": [ ... ],
  "ハンター×ハンター": [ ... ]
};
```

**理解しやすい例**: レストランのメニュー
- **変更前**: 単一のメニュー（全品リスト）
- **変更後**: カテゴリ別のメニューブック（「前菜」「メイン」「デザート」のように分かれている）

この変更により、`QuizApp.tsx` の状態管理も進化しました。新たに `'selecting'` というゲーム状態を追加し、ユーザーがカテゴリを選択するまでクイズが始まらないように制御しています。

```typescript
// ゲーム状態に 'selecting' を追加
const [gameState, setGameState] = useState<'selecting' | 'playing' | 'finished'>('selecting');

// カテゴリ選択時にクイズを開始
const handleStartQuiz = (category: string) => {
  const questions = quizzes[category]; // 選択されたカテゴリの問題を取得
  // ... クイズの初期化処理
  setGameState('playing');
};
```
これにより、より柔軟で拡張性の高いコンポーネント設計となりました。

### 2. コンポーネントの責務の再定義
`QuizStart.tsx` コンポーネントは、単にクイズを開始するボタンから、**カテゴリを選択させる**というより具体的な責務を持つコンポーネントに変わりました。

- **変更前**: `onStart()` を呼び出すだけ。
- **変更後**: `categories` 配列を受け取ってボタンを動的に生成し、選択されたカテゴリ名を `onStart(category)` で親に通知する。

このように、コンポーネントの役割を明確に分けることで、コードの見通しが良くなり、将来的な機能追加（例：カテゴリの追加）が容易になります。これは「関心の分離」という重要な設計原則の実践です。

### 3. Tailwind CSSによる動的レイアウト
カテゴリ選択画面では、Tailwind CSSの `grid` を使用して、画面サイズに応じてボタンのレイアウトが最適化されるようにしました。

```jsx
<div className="grid grid-cols-1 md:grid-cols-3 gap-4">
  {/* ... category buttons ... */}
</div>
```
- `grid`: グリッドレイアウトを有効化
- `grid-cols-1`: 通常は1列で表示
- `md:grid-cols-3`: 中サイズ以上の画面（`md`ブレークポイント）では3列で表示
- `gap-4`: グリッドアイテム間の隙間を設定

レスポンシブデザインをCSSファイルではなく、コンポーネント内で直感的に記述できるのがTailwind CSSの強みです。

## 💡 重要な実装パターン

### 1. 型安全な状態管理
```typescript
interface QuizState {
  currentQuestionIndex: number;
  questions: QuizQuestion[];
  answers: number[];
  isFinished: boolean;
}
```

### 2. コンポーネント分割
- `QuizStart`: 開始画面
- `QuestionCard`: 質問表示
- `QuizResult`: 結果表示
- `QuizApp`: 全体の統合

### 3. イベントハンドリング
```typescript
const selectAnswer = (answerIndex: number) => {
  setSelectedAnswer(answerIndex);
};

const nextQuestion = () => {
  if (selectedAnswer === null) return;
  // 処理を続行
};
```

## 🔍 つまずいたポイント

### 1. 状態更新のタイミング
**問題**: 状態を更新した直後にその値を使おうとすると、古い値が参照される
**解決**: 状態更新は非同期なので、更新された値を直接使用

### 2. 配列の変更
**問題**: 配列を直接変更すると、React が変更を検知できない
**解決**: スプレッド演算子で新しい配列を作成

### 3. 条件付きレンダリング
**問題**: 複数の条件を同時に満たす場合の表示制御
**解決**: 明確な状態管理と条件分岐

## 📈 今後の改善点

### 1. 機能拡張
- [ ] 制限時間の追加
- [ ] 難易度レベルの設定
- [ ] カテゴリ別クイズ
- [ ] ランキング機能

### 2. UI/UX改善
- [ ] アニメーション効果
- [ ] 音効果
- [ ] タッチ操作の改善
- [ ] ダークモード対応

### 3. データ管理
- [ ] 外部APIからの問題取得
- [ ] 問題の動的更新
- [ ] ユーザー履歴の保存
- [ ] 問題の難易度分析

## 🎯 次のステップ

1. **神経衰弱ゲーム（Day 20）**: より複雑な状態管理
2. **ショッピングカート（Day 21）**: グローバル状態管理
3. **Next.js 本格導入（Day 22）**: ルーティングとSSG

## 💭 振り返り

クイズアプリを作成することで、React の状態管理の複雑さと重要性を実感できました。単純に見えるアプリでも、ユーザー体験を考慮すると多くの状態を管理する必要があることを学びました。

特に、配列操作、条件分岐、状態の連携など、実際のアプリケーション開発で必要となる実践的なスキルを身につけることができました。

次回は、より高度な状態管理を学習していきます！ 